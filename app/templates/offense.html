{% extends "base.html" %} {% block content %}
{% block greeting %}Causes that lead to disaster{% endblock %}

<div class="page-content">
    <h2 class="mt-4">Crash Cause Analysis</h2>

    <!-- New 3-column filter row -->
    <div class="row mb-3 gx-3 gy-2 align-items-center">
        <!-- Beat (you already have this) -->
        <div class="col-md-3 d-flex align-items-center">
            <label for="region-select" class="me-2 mb-0 filter-label"
                >Beat:</label
            >
            <div class="select-container">
                <select id="region-select" class="form-select">
                    <option value="all" selected>All Beats</option>
                    {% for b in beats %}
                    <option value="{{ b }}">{{ b }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="col text-end">
            <button id="reset-filters" class="btn btn-secondary">
                Reset Filters
            </button>
        </div>
    </div>

    <div class="row mb-4" id="summary-metrics">
        <!-- Top crash cause -->
        <div class="col-md-6 mb-2">
            <div class="card h-100" style="border-color: #4338ca">
                <div class="card-body">
                    <h3
                        class="card-title"
                        style="
                            color: #4338ca;
                            font-weight: 700;
                            font-size: 1.2rem;
                            margin-bottom: 10px;
                            font-family: 'Source Sans Pro', sans-serif;
                        ">
                        Top Crash Cause
                    </h3>
                    <p id="summary-top-cause" class="card-text fs-4">
                        Loading…
                    </p>
                </div>
            </div>
        </div>

        <!-- Beat with most hit-and-run -->
        <div class="col-md-6 mb-2">
            <div class="card h-100" style="border-color: #4338ca">
                <div class="card-body">
                    <h3
                        class="card-title"
                        style="
                            color: #4338ca;
                            font-weight: 700;
                            font-size: 1.2rem;
                            margin-bottom: 10px;
                            font-family: 'Source Sans Pro', sans-serif;
                        ">
                        Beat with Most Hit-and-Run
                    </h3>
                    <p id="summary-top-hitrun" class="card-text fs-4">
                        Loading…
                    </p>
                </div>
            </div>
        </div>
    </div>
    <!-- Row 1: Chart + Sankey side by side -->
    <div class="row gy-4">
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header">
                    <h4
                        style="
                            color: #4338ca;
                            font-weight: 700;
                            font-size: 1.2rem;
                            margin: 0%;
                            font-family: 'Source Sans Pro', sans-serif;
                        ">
                        Cause → Counts
                    </h4>
                </div>
                <div class="card-body p-3" style="height: 500px">
                    <canvas id="cause-chart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header">
                    <h4
                        style="
                            color: #4338ca;
                            font-weight: 700;
                            font-size: 1.2rem;
                            margin: 0%;
                            font-family: 'Source Sans Pro', sans-serif;
                        ">
                        Cause → Severity
                    </h4>
                </div>
                <div class="card-body">
                    <div
                        id="sankey-chart"
                        class="w-100"
                        style="min-height: 300px"></div>
                </div>
            </div>
        </div>

        <!-- Row 2: Map full-width (or you could split it too) -->
        <div class="col-lg-12">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4
                            style="
                                color: #4338ca;
                                font-weight: 700;
                                font-size: 1.2rem;
                                margin: 0%;
                                font-family: 'Source Sans Pro', sans-serif;
                            ">
                            Hit-and-Run Map
                        </h4>
                    </div>
                    <div class="card-body p-0">
                        <div id="map" style="height: 500px"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endblock %} {% block scripts %}
    <script>
        window.initialLabels={{ labels|tojson }};window.initialValues={{ values|tojson }};
    </script>
    {% endblock %}
</div>
